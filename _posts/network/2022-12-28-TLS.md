---
title:  "[Network] TSL이란?" 

categories:
  - Network
tags:
  - [Network, TSL]

toc: true
toc_sticky: true

date: 2022-12-28
last_modified_at: 2022-12-28
---

## TLS (Transport Layer Security)
### 1. 정의
- 컴퓨터 네트워크에 통신 보안을 제공하기 위해 설계된 암호 규약
- TCP/IP 네트워크를 사용하는 통신에 적용되며, 통신 과정에서 전송 계층 종단간 보안과 데이터 무결성을 확보해준다.

### 2. 개요
  - 웹브라우저, 이메일, 메신저, 인터넷전화와 VoIP등 네트워크를 통해 정보를 전송하는 경우, 정보를 보내는 측과 받는 측이 통신하여 어떤 암호화 알고리즘을 사용할 것인지를 정하고 공개키 기반의 암호키를 교환한 후에 실제 데이터를 암호화하여 전송하는 방식
  - 공개키와 개인키를 교환하여 보안 세션을 생성하여 통신을 암호화하는 방식을 사용
  - MAC 함수 생성을 위해 다른 암호화 알고리즘을 사용하고, 이전 버전의 보안 소켓 계층(SSL)보다 많은 경고 코드를 포함하고 있다.

### 3. 특징
  - 대부분의 다른 보안 프로토콜은 운영체제 등에 밀접하게 관련되어있지만, 응용 프로그램에서 자체적으로 구현이 가능
  - 응용 계층과 전송 계층 사이에 위치하나, 전송 계층과 더 밀접하게 동작하고, 소켓 지향적인 프로토콜
  - 상대 사이트에 대한 신뢰성을 인증하고, 다양한 암호화 알고리즘을 이용하여 메시지를 암호화
  - 송수신 메시지에 대한 체크섬(checksum) 기능이 있고, 변조를 방지
  - 클라이언트와 서버 두 응용 간에 상대방에 대해 인증을 한다. 
  - 메시지 인증 코드 (HMAC)에 의한 메시지 무결성을 제공한다. 또한, 메시지를 압축한다.
  - 디폴트는 널(Null)로, 무압축이다. 압축 알고리즘은 미리 정해져 있지 않고, 협상으로 지정이 가능하다. 
  - 암호화용 세션 키를 생성하기 위한 키를 교환한다. 
  - 생성된 공유 비밀키에 의해 암호화된 종단 간의 안전한 연결 통로를 제공한다.

### 4. 구성
- 5가지의 프로토콜로 구성되어 있다.
#### 1. Handshake Protocol
   - 양쪽 간에 연결을 설정할 때 보안 협상을 위한 프로토콜
   - 서버와 클라이언트 간의 상호 인증을 수행하고, 사용할 키 교환 방식, 대칭키 암호방식, HMAC 방식, 압축 방식 등의 보안 속성을 협상한다. 
  
   <br>

#### 2. Change Cipher Spec Protocol
   - 보안 파라미터를 변경하거나 적용할 때 사용한다.
   - 하나의 메시지로 되어 있으며, 값 1을 갖는 한 바이트로 구성된다.
   - Handshake Protocol에 의해 협상된 아북, MAC, 암호화 방식 등이 적용됨을 상대방에게 알려준다.

   <br>

#### 3. Alert Protocol
   - 오류를 전송할 때 사용되는 프로토콜
   - 경고 메시지는 압축되고, 암호화된다,
   - 프로토콜에 있는 각 메시지는 2바리트로 되어있다.

   <br>

#### 4. Record Protocol
   - 협상된 보안 파라미터를 이요하여 암호화, 복호화, 무결성 검증 등을 수행하는 프로토콜
   - 메시지를 전송하고, 데이터를 블록으로 나눈다.
   - 때에 따라 데이터를 압축하고, MAC을 제공해 암호화하고 그 결과를 전송한다.

   <br>

#### 5. Application Protocol
   - 실제 데이터가 전송될 때 사용되는 프로토콜

### 암호 기본 요소
#### 1. 대칭키 암호화
- 암호화를 하는 데 사용하는 키와 복호화를 하는 데 사용하는 키가 같은 암호화
- 수행 속도가 빠르고, 키를 아는 살마만 암호화화 복호화를 할 수 있다는 점에서 기밀성, 그리고 단 둘만 키를 가지고 있다면 그 자체로도 약간의 인증성을 제공할 수 있는 장점이 있다.
- 멀리 떨어져 있는 두 대상이 안전하지 않은 네트워크를 사이에 두고 같은 키를 어떻게 공유할 것 인가가 문제점

#### 2. 비대칭 키 암호화
- 암호화 단계에 사요하는 키와 복호화 단계에 사용하는 키가 다른 암호화
- 키는 한 쌍으로 구성되는데, 하나의 키로 암호화한 것은 다른 한쪽의 키로 복호화할 수 있다.
- 일반적으로 하나는 안전하게 보관하는 개인키로 사용하고, 다른 하나는 공개하는 공개 키로 사용한다.
- 특정 공개 키에 대한 개인키의 소유를 증명할 수 있는 인증성을 보장하고, 실제 암호화에서 사용할 세션 키를 안전하지 않은 채널을 통해 교환하는 방법으로 사용할 수 잇다.
- 공개키로 암호화한 것은 개인키를 이용해야만 복호화가 가능하다는 점에서 단방향으로 기밀성을 보장한다.
- 암호화와 복호화의 비용이 크기 때문에 일반적인 함호화 통신에는 대칭키 암호화를 사용한다.

#### 3. 디지털 인증서
- 상대방이 통신하고자 하는 대상을 확인하기 위해 디지털 인증서를 사용한다. 
- 디지털 인증서는 모두가 신뢰할 수 있는 제 3자인 인증기관(Certificate Authority, CA)과 비대칭 키 암호화가 필요하다. 
- 밥은 인증기관(CA)에 자신을 다양한 방식으로 증명하고, 자신의 공개 키가 밥의 공개 키가 맞음을 인증하는 인증서를 발급받는다. 
- 이후 앨리스에게 인증서를 주고, 앨리스는 자신이 신뢰할 수 있는 인증기관(CA)이 발급한 인증서인지 확인하고, 맞으면 인증서에 포함된 밥의 공개 키로 데이터를 암호화해서 전달한다. 
- 밥이 이것을 올바르게 복호화하면, 인증기관(CA)이 인증하는 밥의 공개 키에 대응하는 개인키를 가지고 있다는 것이기 때문에 이 과정을 통해 현재 통신하고 있는 상대방을 인증할 수 있다.

#### 4. 대칭키 암호화를 사용하기 위해 안전하지 않은 네트워크상에서 안전하게 키를 교환할 수 있어야 한다. 이 역할을 하는 것이 키 합의 프로토콜이다. <br> 이 방법에는 크게 두 가지가 있다. 하나는 비대칭 키 암호화 중 대표적인 RSA를 기반으로 한 프로토콜이고, 다른 하나는 디피-헬만 키 합의 프로토콜이다.
   1. RSA 키 합의 프로토콜
   - 앨리스가 밥의 공개키를 알고 있을 때, 앨리스가 둘의 통신에 사용할 세션 키를 만들어 공개 키로 암호화한 다음 전송한다. 
   - 이를 복호화할 수 있는 개인 키를 가지고 있는 사람은 밥뿐이므로, 제 3자인 이브는 세션 키를 얻을 수 없고, 둘은 안전하게 세션 키를 교환하여 보안 채널을 만들 수 있다. 
   - 하지만 이 방식에는 새로운 보안 문제가 있다. 밥의 개인 키를 모르는 이브는 둘의 모든 통신을 기록하고, 밥의 개인 키를 알아내면 그동안 기록해 둔 것을 복호화하여 세션 키를 얻는다. 세션 키를 얻으면 둘의 대화 내용을 알아낼 수 있기 때문이다. 
   - 개인 키가 유출되고 나면, 둘의 통신이 유출되기 전에 일어났다고 해도 안전하지 않다. 
   - 이 상황을 대비하여, 현재만 안전한 것이 아니라, 미래에 개인 키가 유출되어도 안전하게 하는 보안 목표를 순방향 비밀성(Forward Secrecy), 또는 완전 순방향 비밀성(Perfect Forward Secrecy)이라고 한다.
   2. 디피-헬만 키 합의 프로토콜
   - 안전하지 않은 채널에서 안전하게 세션 키를 만들 수 있게 하고, 순방향 비밀성도 보장한다. 
   - 네트워크를 통해 세션 키를 전달하는 것이 아니라, 세션 키를 만들 수 있는 힌트만 네트워크상으로 전달하기 때문에 가능하다. 
   - 목표는 앨리스와 밥이 안전하지 않은 통신을 통해 공통의 색을 만드는 것이다. 
   - 색의 혼합이 일방향 함수라는 가정이 있다. 즉, 두 색을 섞어 새로운 색을 만들기는 쉽지만, 섞여 있는 두 색을 원래의 색으로 분리하는 것은 어렵다. 
   - 앨리스와 밥은 통신에 사용할 색을 공개적으로 정한 후, 각자 비밀 색을 정한다. 
   - 직접 비밀 색을 전송하지 않고, 기저 색과 비밀 색을 섞은 결과를 전송한다. 각자 받은 것을 비밀 색과 섞어 공통의 색을 만들 수 있다. 
   - 하지만 이브는 기저 색과 다른 색을 가지고도 가정에 의해서 공통의 색을 만들 수 없다. 훗날 비밀 색을 알아내면 공통 색을 만들 수 있기에, 앨리스와 밥은 필요하지 않은 비밀 색을 버린다. 
   - 이 방식을 수학적으로 구현한 것이 디피-헬만 키 합의 프로토콜이다. 
   - 이 방식을 이용하면, 툴의 통신을 기록해두고, 밥의 개인키를 탈취하더라도 얻을 수 있는 것은 힌트 뿐이기에 복호화할 수 없다.



###### Reference
- https://ko.wikipedia.org/wiki/%EC%A0%84%EC%86%A1_%EA%B3%84%EC%B8%B5_%EB%B3%B4%EC%95%88
- http://wiki.hash.kr/index.php/TLS
